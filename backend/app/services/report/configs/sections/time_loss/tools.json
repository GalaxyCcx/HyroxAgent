{
  "section_id": "time_loss",
  "description": "时间损耗章节 - 价值主张、损耗总览、三 Tab 分段对比、深度归因（固定四大方向）",

  "tool": {
    "type": "function",
    "function": {
      "name": "generate_time_loss_section",
      "description": "生成时间损耗分析章节：价值主张、导言、损耗总览表（含难度星级）、Running/Workout/Roxzone 分段对比、深度归因（固定转换区/跑步/功能站/节奏四大方向，每方向好坏+明细）",
      "parameters": {
        "type": "object",
        "properties": {
          "value_proposition": {
            "type": "string",
            "description": "价值主张，一句理论最佳成绩，如「同样的体能付出，通过战术执行修正，你本场比赛的理论上限是 1:21:06」"
          },
          "intro_text": {
            "type": "string",
            "description": "导言段落，解释这些时间损耗的性质（不需要提升体能，只需改变策略）"
          },
          "loss_overview": {
            "type": "object",
            "description": "损耗总览，items 须与输入中的 canonical_loss_items 逐条对应，与 1.3 一致",
            "properties": {
              "total_loss_seconds": { "type": "number", "description": "总损耗秒数" },
              "total_loss_display": { "type": "string", "description": "总损耗展示，如 \"-5:00\"" },
              "items": {
                "type": "array",
                "description": "损耗明细，须与输入中的 canonical_loss_items 逐条对应（几条就几条、source 一致），不漏不造；顺序可自定",
                "minItems": 0,
                "maxItems": 8,
                "items": {
                  "type": "object",
                  "properties": {
                    "source": { "type": "string", "description": "损耗来源名称，如 ROXZONE (转换区)、Run 8 (配速)、Sled Push" },
                    "source_desc": { "type": "string", "description": "简短描述" },
                    "loss_seconds": { "type": "number" },
                    "loss_display": { "type": "string", "description": "如 -2:30" },
                    "improvement_display": { "type": "string", "description": "可选，区域可提升展示，来自 improvement_agent_result 时如「约 25 秒」" },
                    "difficulty": { "type": "string", "description": "星级：⭐ / ⭐⭐ / ⭐⭐⭐" },
                    "difficulty_level": { "type": "number", "description": "1/2/3" }
                  },
                  "required": ["source", "source_desc", "loss_seconds", "loss_display", "difficulty", "difficulty_level"]
                }
              }
            },
            "required": ["total_loss_seconds", "total_loss_display", "items"]
          },
          "segment_comparison": {
            "type": "object",
            "description": "三 Tab 分段对比：Running / Workout / Roxzone",
            "properties": {
              "running": {
                "type": "object",
                "properties": {
                  "chart_data": { "type": "array", "description": "柱状图+折线图数据，如 [{segment, you, top10}] 秒数" },
                  "table_data": { "type": "array", "description": "表格行：segment, you, top10, diff, highlight；highlight 可多行为 true，与柱状图标红一致" },
                  "conclusion_blocks": {
                    "type": "array",
                    "description": "结论块：每个 highlight=true 的段落一块，顺序与 table_data 一致；有多少 highlight 段就多少块（不固定 Run 5/Run 8）",
                    "items": {
                      "type": "object",
                      "properties": {
                        "segment": { "type": "string", "description": "段落名，与 table_data 该行 segment 一致，如 Run 5、Run 8、Run 6 等" },
                        "gap_vs_top10": { "type": "string", "description": "与 Top 10% 的差距，必须用 table_data 的 you、top10、diff" },
                        "pacing_issue": { "type": "string", "description": "该段的配速问题简述" },
                        "improvement_display": { "type": "string", "description": "提升空间展示；有 improvement_agent_result 时用 Agent 该段的 recommended_improvement_seconds 格式化，不得超过 table 的 diff" },
                        "improvement_logic": { "type": "string", "description": "计算逻辑：写清与 Top 10% 差距、1.1 配速损耗、可提升上限取较小值、推荐值及理由，见 prompt" }
                      },
                      "required": ["segment", "gap_vs_top10", "pacing_issue", "improvement_display", "improvement_logic"]
                    }
                  },
                  "warning": { "type": "object", "description": "兼容旧格式；若有 conclusion_blocks 则优先展示 conclusion_blocks", "properties": { "title": { "type": "string" }, "content": { "type": "string" } } }
                }
              },
              "workout": {
                "type": "object",
                "properties": {
                  "chart_data": { "type": "array" },
                  "table_data": { "type": "array", "description": "照抄 workout_vs_top10_table；每行可设 highlight" },
                  "conclusion_blocks": {
                    "type": "array",
                    "description": "结论块：每个 highlight=true 的功能站一块，格式同 running",
                    "items": {
                      "type": "object",
                      "properties": {
                        "segment": { "type": "string", "description": "功能站名，与 table_data 一致" },
                        "gap_vs_top10": { "type": "string", "description": "与 Top 10% 的差距，照抄该行 you、top10、diff" },
                        "pacing_issue": { "type": "string", "description": "该站问题简述" },
                        "improvement_display": { "type": "string", "description": "提升空间，用 improvement_agent_result.workout 该站 recommended_improvement_seconds 格式化" },
                        "improvement_logic": { "type": "string", "description": "计算逻辑：与 Top 10% 差距、1.1 损耗、可提升上限、推荐值及理由" }
                      },
                      "required": ["segment", "gap_vs_top10", "pacing_issue", "improvement_display", "improvement_logic"]
                    }
                  },
                  "highlight": { "type": "object", "properties": { "title": { "type": "string" }, "content": { "type": "string" } } },
                  "warning": { "type": "object", "properties": { "title": { "type": "string" }, "content": { "type": "string" } } }
                }
              },
              "roxzone": {
                "type": "object",
                "properties": {
                  "comparison": {
                    "type": "object",
                    "properties": {
                      "you": { "type": "object", "properties": { "value": { "type": "string" }, "seconds": { "type": "number" } } },
                      "top10": { "type": "object", "properties": { "value": { "type": "string" }, "seconds": { "type": "number" } } },
                      "avg": { "type": "object", "properties": { "value": { "type": "string" }, "seconds": { "type": "number" } } }
                    }
                  },
                  "warning": { "type": "object", "properties": { "title": { "type": "string" }, "content": { "type": "string" } } }
                }
              }
            },
            "required": ["running", "workout", "roxzone"]
          },
          "deep_analysis": {
            "type": "object",
            "description": "深度归因：固定四个大方向（转换区、跑步、功能站、节奏），每方向 status 好/坏，坏则 details 列明细",
            "properties": {
              "categories": {
                "type": "array",
                "description": "固定 4 项，顺序：转换区、跑步、功能站、节奏",
                "minItems": 4,
                "maxItems": 4,
                "items": {
                  "type": "object",
                  "properties": {
                    "key": { "type": "string", "description": "转换区 | 跑步 | 功能站 | 节奏" },
                    "label": { "type": "string", "description": "展示名称，如 转换区 (ROXZONE)" },
                    "status": { "type": "string", "enum": ["good", "bad"], "description": "该方向整体表现" },
                    "summary": { "type": "string", "description": "一句话概括" },
                    "details": {
                      "type": "array",
                      "description": "仅 status=bad 时非空；每条类似 demo 明细",
                      "items": {
                        "type": "object",
                        "properties": {
                          "source": { "type": "string" },
                          "loss_display": { "type": "string" },
                          "difficulty": { "type": "string" },
                          "analysis_title": { "type": "string" },
                          "analysis_content": { "type": "string" }
                        },
                        "required": ["source", "loss_display", "difficulty", "analysis_title", "analysis_content"]
                      }
                    }
                  },
                  "required": ["key", "label", "status", "summary", "details"]
                }
              }
            },
            "required": ["categories"]
          }
        },
        "required": ["value_proposition", "loss_overview", "deep_analysis"]
      }
    }
  },
  "tool_choice": {
    "type": "function",
    "function": { "name": "generate_time_loss_section" }
  },
  "blocks_mapping": {
    "value_proposition": { "type": "text", "component": "QuoteBox" },
    "intro_text": { "type": "text", "component": "Paragraph" },
    "loss_overview": { "type": "table", "component": "LossOverviewTable" },
    "segment_comparison": { "type": "chart", "component": "SegmentTabs" },
    "deep_analysis": { "type": "list", "component": "DeepAnalysisList" }
  }
}
