# PRD v10.0 - 核心摘要雷达图优化

## 版本信息
- **版本号**: v10.0
- **日期**: 2026-01-29
- **状态**: 已完成

## 背景

在专业分析报告的核心摘要章节中，原计划需要展示一个三维能力雷达图（力量、有氧底座、转换效率），用于直观展示运动员的综合能力评估。但由于以下问题，雷达图一直未能正确显示：

1. **章节定义缺失**：`section_definitions_v2.py` 中的 summary 章节图表配置没有包含 radar 类型
2. **数据格式不匹配**：后端生成的是 ECharts 配置格式，但前端 `RadarChart` 组件期望的是 `dimensions` + `dataSets` 格式
3. **渲染逻辑缺失**：`IntroductionCard` 组件没有图表渲染逻辑

## 功能概述

### 目标
在核心摘要卡片中展示 ZONEØ 三维能力雷达图，帮助用户直观了解自己在三个维度上的能力水平。

### 三维能力定义

| 维度 | 英文名 | 计算依据 | 说明 |
|------|--------|----------|------|
| 力量 | Strength | 功能站表现 | 8个功能站成绩与组别平均的对比 |
| 有氧底座 | Aerobic Base | 跑步段表现 | 8段跑步配速稳定性和绝对水平 |
| 转换效率 | Transition | Roxzone时间 + 配速衰减 | 功能站-跑步转换效率 |

### 显示效果

```
┌─────────────────────────────────────────────────┐
│  核心摘要：ZONEØ 战力值                          │
├─────────────────────────────────────────────────┤
│                                                  │
│   ┌──────────────┐  ┌────────────────────────┐  │
│   │   ROXSCAN    │  │ • 力量: 72分           │  │
│   │     75       │  │ • 有氧底座: 68分        │  │
│   │   进阶级 A    │  │ • 转换效率: 81分        │  │
│   └──────────────┘  └────────────────────────┘  │
│                                                  │
│   一句话总结：该运动员展现出优秀的转换能力...      │
│                                                  │
│   💪 优势: 转换区表现出色                         │
│   📊 待提升: 后半程配速衰减明显                   │
│                                                  │
│   ┌─────────────────────────────────────────┐   │
│   │        ZONEØ 三维能力雷达图              │   │
│   │                                          │   │
│   │              力量                         │   │
│   │               ▲                          │   │
│   │              /│\                         │   │
│   │             / │ \                        │   │
│   │            /  │  \                       │   │
│   │   有氧底座◀───┼───▶转换效率              │   │
│   │                                          │   │
│   │        综合评分: 74分                     │   │
│   └─────────────────────────────────────────┘   │
│                                                  │
└─────────────────────────────────────────────────┘
```

## 技术方案

### 1. 章节定义更新

在 `section_definitions_v2.py` 的 summary 章节中添加 radar 图表配置：

```python
"charts": [
    {
        "chart_id": "chart_summary_radar",
        "chart_type": "radar",
        "title": "ZONEØ 三维能力雷达图",
        "description": "展示力量、有氧底座、转换效率三维能力评估",
        "data_source": "percentile_ranking",
    },
    # ... 其他图表
]
```

### 2. 图表构建器更新

修改 `chart_builder.py` 中的 `_build_radar_chart` 方法，输出前端组件期望的格式：

```python
# 输出格式
config = {
    "dimensions": [
        {"name": "力量", "max": 100, "description": "功能站表现"},
        {"name": "有氧底座", "max": 100, "description": "跑步耐力"},
        {"name": "转换效率", "max": 100, "description": "Roxzone时间"},
    ],
    "dataSets": [
        {
            "name": "运动员",
            "values": [strength_score, endurance_score, efficiency_score]
        }
    ],
    "title": "ZONEØ 三维能力评估",
    "subtitle": f"综合评分: {overall_score}分",
    "showLegend": True,
}
```

### 3. 前端组件更新

修改 `IntroductionCard` 组件，支持渲染图表：

```typescript
interface IntroductionCardProps {
  introduction: string;
  charts?: Record<string, any>;  // 新增 charts 参数
}

// 在组件内部查找并渲染 radar 类型图表
{charts && (() => {
  const radarChart = Object.values(charts).find(
    (chart: any) => chart.chart_type === 'radar'
  );
  if (radarChart && radarChart.config) {
    return (
      <ReportChart
        chartId={radarChart.chart_id}
        config={radarChart.config}
        chartType="radar"
      />
    );
  }
})()}
```

## 数据流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                        报告生成流程                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. ChartBuilder.build_all_charts()                             │
│     └─> _build_radar_chart()                                    │
│         └─> 计算三维能力值                                       │
│             • strength_score  (功能站)                          │
│             • endurance_score (跑步段)                          │
│             • efficiency_score (转换效率)                        │
│         └─> 生成 RadarChart 组件格式配置                         │
│                                                                  │
│  2. SectionAgent.generate_section("summary")                    │
│     └─> _prepare_charts()                                       │
│         └─> 从 section_definitions_v2 获取图表配置               │
│             • chart_summary_radar (radar)                       │
│             • chart_summary_heatmap (heatmap)                   │
│             • chart_summary_distribution (distribution)         │
│                                                                  │
│  3. ReportGenerator._merge_charts()                             │
│     └─> 将预构建图表与章节图表配置合并                            │
│         └─> radar 图表数据传递到前端                             │
│                                                                  │
│  4. Frontend LiveTab.tsx                                        │
│     └─> IntroductionCard                                        │
│         └─> 从 charts 中提取 radar 类型图表                      │
│         └─> 渲染 ReportChart -> RadarChart                       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 文件修改清单

| 文件路径 | 修改内容 |
|----------|----------|
| `backend/app/services/report/section_definitions_v2.py` | 添加 radar 图表到 summary 章节的 charts 配置 |
| `backend/app/services/report/chart_builder.py` | 修改 `_build_radar_chart` 输出格式为前端组件期望的格式 |
| `frontend/src/screens/LiveTab.tsx` | IntroductionCard 组件支持渲染 charts 中的雷达图 |

## 验收标准

- [ ] 核心摘要卡片下方显示三维雷达图
- [ ] 雷达图正确显示力量、有氧底座、转换效率三个维度
- [ ] 雷达图显示综合评分副标题
- [ ] 雷达图样式与整体报告风格一致（暗色主题）

## 后续优化方向

1. **对比功能**：支持与历史成绩或目标成绩的雷达图叠加对比
2. **动态更新**：支持用户切换不同维度权重查看能力评估
3. **分享功能**：支持单独导出雷达图为图片
