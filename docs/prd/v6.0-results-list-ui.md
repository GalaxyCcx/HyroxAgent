# PRD v6.0: 成绩列表 UI 升级

## 一、版本信息

| 项目 | 内容 |
|------|------|
| 版本号 | v6.0 |
| 功能名称 | 成绩列表 UI 升级 |
| 迭代日期 | 2026-01-23 |
| 状态 | **🚧 开发中** |

### 版本变更记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2026-01-19 | 初始后端 API 开发，使用 pyrox-client 实时查询 |
| v2.0 | 2026-01-20 | 前端开发，4 Tab 结构 |
| v3.0 | 2026-01-21 | 比赛数据 Tab 搜索流程优化 |
| v4.0 | 2026-01-22 | Tab 架构重构为 3 Tab |
| v5.0 | 2026-01-22 | 本地 SQLite 数据存储 |
| v5.1 | 2026-01-22 | 排行榜筛选逻辑修复 |
| v6.0 | 2026-01-23 | **成绩列表 UI 升级**：三级筛选架构重构、列表项样式优化、年龄组筛选支持 |

---

## 二、功能概述

### 2.1 背景

当前成绩列表界面的筛选器和列表项样式与最新设计规范存在差异：

1. **筛选器架构不完整**：缺少年龄组筛选功能
2. **二级筛选展现形式单一**：使用 Chips 而非 Segmented 按钮
3. **列表项信息展示不够清晰**：排名格式、性别标识、副信息布局需优化
4. **搜索功能不够便捷**：缺少可折叠的搜索栏

### 2.2 目标

- 实现三级筛选架构：赛事类型 → 组别 → 性别/年龄组
- 后端 API 支持年龄组筛选参数
- 优化列表项视觉呈现，提升信息可读性
- 添加可折叠搜索栏，提升搜索体验

---

## 三、功能规格

### 3.1 筛选器三级架构

```
┌─────────────────────────────────────────────────────────────────┐
│  一级：赛事类型 Tab                                              │
│  ┌──────────────┬──────────────┐                                │
│  │    单人赛    │    双人赛    │                                │
│  └──────────────┴──────────────┘                                │
├─────────────────────────────────────────────────────────────────┤
│  二级：组别 Segmented                                            │
│  ┌────────────────────┬────────────────────┐                    │
│  │  Open (公开组)     │    Pro (精英组)    │                    │
│  └────────────────────┴────────────────────┘                    │
├─────────────────────────────────────────────────────────────────┤
│  三级：性别胶囊 + 年龄组下拉                                      │
│  ┌────┬────┬────┐  ┌─────────────────┐                         │
│  │ 男 │ 女 │混双│  │ 年龄组: 全部  ▼│                         │
│  └────┴────┴────┘  └─────────────────┘                         │
└─────────────────────────────────────────────────────────────────┘
```

#### 3.1.1 一级：赛事类型 Tab

| 选项 | 值 | 说明 |
|------|-----|------|
| 单人赛 | `SINGLE` | 对应 division: `open`, `pro` |
| 双人赛 | `DOUBLES` | 对应 division: `doubles`, `pro_doubles` |

#### 3.1.2 二级：组别 Segmented 按钮

| 选项 | 单人赛对应 | 双人赛对应 |
|------|-----------|-----------|
| Open (公开组) | `open` | `doubles` |
| Pro (精英组) | `pro` | `pro_doubles` |

样式：选中态使用 `bg-primary/10 border-primary text-primary`

#### 3.1.3 三级：性别胶囊 + 年龄组下拉

**性别胶囊：**

| 赛事类型 | 可选性别 |
|----------|---------|
| 单人赛 | 男子 (`male`) / 女子 (`female`) |
| 双人赛 | 男子 (`male`) / 女子 (`female`) / 混双 (`mixed`) |

**年龄组下拉：**

| 赛事类型 | 组别 | 年龄组选项 |
|----------|------|-----------|
| 单人赛 | Open | 16-24, 25-29, 30-34, 35-39, 40-44, 45-49, 50-54, 55-59, 60-64, 65-69, 70+ |
| 单人赛 | Pro | 16-24, 25-29, 30-34, 35-39, 40-44, 45-49, 50-54, 55-59, 60-64, 65-69 |
| 双人赛 | All | 16-29, 30-39, 40-49, 50-59, 60-70+ |

> 注：Pro 组别不包含 70+ 年龄组

---

### 3.2 列表项样式

```
┌────────────────────────────────────────────────────────────────┐
│  ┌────┐                                                        │
│  │ 1  │  Chen, Yuanmin  ♀                           01:02:35  │
│  └────┘  ┌──────┐                                    [查看]    │
│          │ OPEN │  25-29                                       │
│          └──────┘                                              │
└────────────────────────────────────────────────────────────────┘
```

| 元素 | 规格 |
|------|------|
| 排名数字 | 纯数字（无 # 前缀），固定宽度 `w-8`，居中对齐，斜体 |
| 前三名 | 黄色文字 `text-yellow-500` |
| 女性图标 | 粉色 female 图标 `text-pink-400`，仅女性选手显示 |
| 组别徽章 | 小号标签 `bg-white/5 px-1.5 py-0.5 rounded border border-white/5` |
| 年龄组 | 纯文本 `text-white/40` |

---

### 3.3 可折叠搜索栏

- 顶部右侧搜索图标可切换搜索栏显示/隐藏
- 搜索栏展开时带有动画效果 `animate-in fade-in slide-in-from-top-2`
- 搜索框 placeholder 根据赛事类型动态变化：
  - 单人赛：`输入 姓名 / 参赛号`
  - 双人赛：`输入 队名 / 队员 / 参赛号`

---

## 四、API 变更

### 4.1 排行榜接口扩展

**接口：** `GET /api/v1/races/{season}/{location}/leaderboard`

**新增参数：**

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| age_group | string | 否 | 年龄组筛选，如 `16-24`, `25-29` 等 |

**示例请求：**

```
GET /api/v1/races/7/hong-kong/leaderboard?division=open&gender=male&age_group=25-29
```

---

## 五、前端状态管理

### 5.1 新增状态变量

```typescript
// 筛选状态
const [resultAgeGroup, setResultAgeGroup] = useState<string>('ALL');

// UI 状态
const [showSearch, setShowSearch] = useState(false);
const [showAgeDropdown, setShowAgeDropdown] = useState(false);
const ageDropdownRef = useRef<HTMLDivElement>(null);
```

### 5.2 年龄组常量

```typescript
const AGE_GROUPS_SINGLE_COMMON = [
  '16-24', '25-29', '30-34', '35-39', '40-44', 
  '45-49', '50-54', '55-59', '60-64', '65-69'
];

const AGE_GROUPS_SINGLE_OPEN_EXTRA = ['70+'];

const AGE_GROUPS_DOUBLES = [
  '16-29', '30-39', '40-49', '50-59', '60-70+'
];
```

### 5.3 动态年龄组选项逻辑

```typescript
const getAgeOptions = () => {
  if (raceTypeFilter === 'doubles') return AGE_GROUPS_DOUBLES;
  
  // SINGLE
  if (divisionFilter === 'pro') {
    return AGE_GROUPS_SINGLE_COMMON;
  } else {
    // OPEN includes 70+
    return [...AGE_GROUPS_SINGLE_COMMON, ...AGE_GROUPS_SINGLE_OPEN_EXTRA];
  }
};
```

---

## 六、交互逻辑

### 6.1 筛选器联动

1. 切换赛事类型时，重置组别为默认值
2. 切换组别时，若当前年龄组不在新选项中，重置为 `ALL`
3. 年龄组下拉菜单支持点击外部关闭

### 6.2 数据请求

- 筛选器变化时自动触发数据请求
- 年龄组为 `ALL` 时不传递 `age_group` 参数

---

## 七、文件变更清单

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `backend/app/api/v1/races.py` | 修改 | 添加 age_group 筛选参数 |
| `frontend/src/screens/LiveTab.tsx` | 修改 | 重构筛选器 UI、列表项样式、添加状态变量 |
| `docs/prd/v6.0-results-list-ui.md` | 新增 | 本文档 |

---

## 八、验收标准

- [ ] 三级筛选器正确显示并联动
- [ ] 年龄组下拉菜单选项根据赛事类型和组别动态变化
- [ ] 后端 API 正确响应 age_group 参数
- [ ] 列表项样式与设计规范一致
- [ ] 可折叠搜索栏正常工作
- [ ] 女性选手正确显示性别图标

