# PRD v4.0: 前端架构重构

## 一、版本信息

| 项目 | 内容 |
|------|------|
| 版本号 | v4.0 |
| 功能名称 | 前端 Tab 架构重构 & UI 升级 |
| 迭代日期 | 2026-01-22 |
| 状态 | **已完成** |

### 版本变更记录

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v2.0 | 2026-01-20 | 初始前端开发，4 Tab 结构 |
| v3.0 | 2026-01-21 | 比赛数据 Tab 搜索流程优化 |
| v3.1 | 2026-01-21 | 流程优化，移除 RACE_LIST 中间页 |
| v4.0 | 2026-01-22 | **Tab 架构重构为 3 Tab，UI 全面升级** |

---

## 二、功能概述

将前端从 4 Tab 架构重构为 3 Tab 架构，优化页面布局和用户流程，同时保留已有的搜索 API 对接功能。

### 核心变更
1. Tab 导航从 4 个精简为 3 个：首页 / 比赛 / 我的
2. LiveTab (首页) 新增近期赛事展示和赛后分析 Lite 视图
3. DataTab (我的) 新增 Profile 个人资料首页
4. 保留完整的搜索 API 对接和数据展示功能

---

## 三、Tab 架构变更

### 3.1 架构对比

| 项目 | v3.1 (旧版) | v4.0 (新版) |
|------|------------|------------|
| Tab 数量 | 4 个 | 3 个 |
| Tab 1 | 首页 (HOME) -> LiveTab | 首页 (HOME) -> LiveTab |
| Tab 2 | 比赛数据 (DATA) -> DataTab | 比赛 (RACE) -> PlanTab |
| Tab 3 | 计划 (PLAN) -> PlanTab | 我的 (ME) -> DataTab |
| Tab 4 | 我的 (ME) -> AgentTab | - (已移除) |

### 3.2 类型定义变更

```typescript
// v3.1
export enum AppTab {
  HOME = 'home',
  PLAN = 'plan',
  DATA = 'data',
  ME = 'me'
}

// v4.0
export enum AppTab {
  HOME = 'home',   // 首页 - LiveTab
  RACE = 'race',   // 比赛 - PlanTab
  ME = 'me'        // 我的 - DataTab
}
```

---

## 四、页面状态设计

### 4.1 LiveTab (首页)

| 状态 | 触发条件 | 页面内容 |
|------|---------|---------|
| **HOME** | 进入首页 Tab | 近期赛事展示 + 搜索入口 |
| **SEARCH** | 点击搜索框 | 搜索运动员（名称建议） |
| **RESULTS** | 选择运动员 | 成绩列表/排行榜展示 |
| **SUMMARY** | 点击成绩卡片 | 比赛总结页面 |
| **ANALYSIS_LITE** | 点击快速分析 | 赛后快速分析（静态） |

### 4.2 DataTab (我的)

| 状态 | 触发条件 | 页面内容 |
|------|---------|---------|
| **PROFILE** | 进入"我的" Tab | 个人资料 + 比赛历史 |
| **SEARCH_ACTIVE** | 点击搜索 | 搜索运动员（名称建议） |
| **HUB** | 选择运动员 | 数据中心（全部比赛卡片） |
| **SUMMARY** | 点击卡片 | 单场比赛总结 |
| **SPLIT_CENTER** | 点击进入分段 | 分段成绩（3个 Tab：总览/Run/Station） |
| **STATION_DETAIL** | 点击站点 | 站点深挖详情 |
| **POSTER** | 点击生成海报 | 战报海报预览 |

### 4.3 PlanTab (比赛)

保持不变，包含以下视图：
- REPORT (分析报告)
- SCHEDULE (训练计划)
- SUBSCRIPTION (订阅页面)
- COACH_LIST (教练列表)

---

## 五、用户流程

### 5.1 首页流程

```
用户打开应用
    │
    ▼
┌─────────────────┐
│ 首页 (HOME)      │
│ - 近期赛事展示    │
│ - 搜索入口       │
└─────────────────┘
    │
    ├─ 点击赛事卡片 → 赛事详情（待开发）
    │
    └─ 点击搜索 → SEARCH 页面
           │
           ▼
       输入关键词
           │
           ▼
       选择运动员
           │
           ▼
    ┌─────────────────┐
    │ RESULTS 页面     │
    │ 成绩列表         │
    └─────────────────┘
           │
           ▼
       点击成绩卡片
           │
           ▼
    ┌─────────────────┐
    │ SUMMARY 页面     │
    │ 比赛总结         │
    └─────────────────┘
           │
           └─ 点击快速分析 → ANALYSIS_LITE
```

### 5.2 我的页面流程

```
用户点击"我的" Tab
    │
    ▼
┌─────────────────┐
│ PROFILE 页面     │
│ - 个人资料       │
│ - 统计数据       │
│ - 历史比赛       │
└─────────────────┘
    │
    ├─ 点击历史比赛 → (待开发：直接查看详情)
    │
    └─ 点击搜索其他运动员 → SEARCH_ACTIVE
           │
           ▼
       输入关键词 → 选择运动员
           │
           ▼
    ┌─────────────────┐
    │ HUB 数据中心     │
    │ 全部比赛卡片     │
    └─────────────────┘
           │
           ▼
       点击卡片 → SUMMARY → SPLIT_CENTER → STATION_DETAIL
                    │
                    └─ 生成海报 → POSTER
```

---

## 六、新增类型定义

```typescript
// 用户个人资料
export interface ProfileStats {
  completed: number;      // 已完成比赛数
  pb: string;             // 个人最佳成绩
  ageGroup: string;       // 年龄组
  rank: string;           // 最近排名
}

export interface UserProfile {
  name: string;
  id: string;
  avatar?: string;
  isPro?: boolean;
  stats: ProfileStats;
}

// 赛事信息
export interface RaceEvent {
  id: string;
  name: string;
  location: string;
  venue: string;
  date: string;
  month: string;
  day: string;
  status: 'upcoming' | 'live' | 'completed';
}

// 排行榜数据
export interface LeaderboardEntry {
  rank: number;
  name: string;
  ageGroup: string;
  time: string;
  isMe: boolean;
}
```

---

## 七、静态数据说明

以下内容暂使用静态 Mock 数据：

| 功能 | 数据类型 | 说明 |
|------|---------|------|
| 近期赛事 | `RaceEvent[]` | 2 个示例赛事 |
| 排行榜 | `LeaderboardEntry[]` | 7 条示例数据 |
| 个人资料 | `UserProfile` | 固定用户信息 |
| 赛后分析 | 静态文案 | 优势/短板分析 |

搜索相关功能继续使用真实后端 API。

---

## 八、API 保持不变

本次迭代不涉及后端 API 变更，以下接口继续使用：

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 名称建议 | GET | `/api/v1/athletes/suggest` | 第一阶段搜索 |
| 搜索运动员 | GET | `/api/v1/athletes/search` | 第二阶段搜索 |
| 成绩详情 | GET | `/api/v1/results/{season}/{location}/{name}` | 详情页数据 |
| 分段统计 | GET | `/api/v1/results/{season}/{location}/{name}/analytics` | 分段分析 |

---

## 九、文件变更清单

| 操作 | 文件路径 | 说明 |
|------|----------|------|
| 修改 | `frontend/src/types.ts` | AppTab 枚举改为 3 个，新增 Profile 等类型 |
| 修改 | `frontend/src/App.tsx` | 底部导航改为 3 Tab |
| 重构 | `frontend/src/screens/LiveTab.tsx` | 新增 HOME/RESULTS/SUMMARY/ANALYSIS_LITE 视图 |
| 重构 | `frontend/src/screens/DataTab.tsx` | 新增 PROFILE 视图作为默认首页 |
| 保留 | `frontend/src/screens/PlanTab.tsx` | 无变更 |
| 保留 | `frontend/src/services/api.ts` | 无变更 |
| 保留 | `frontend/src/hooks/useAthleteSearch.ts` | 无变更 |
| 保留 | `frontend/src/components/AthleteSearchView.tsx` | 无变更 |

---

## 十、验收标准

### 10.1 Tab 导航
1. ✅ 底部导航为 3 个 Tab：首页 / 比赛 / 我的
2. ✅ 点击各 Tab 正确切换对应页面
3. ✅ 当前 Tab 显示高亮指示器

### 10.2 LiveTab (首页)
4. ✅ 首页显示近期赛事卡片
5. ✅ 点击搜索框进入搜索页面
6. ✅ 搜索功能正常：输入 → 建议 → 比赛列表
7. ✅ 点击比赛卡片进入比赛总结
8. ✅ 点击快速分析进入 ANALYSIS_LITE 页面

### 10.3 DataTab (我的)
9. ✅ 默认显示 PROFILE 个人资料页
10. ✅ 显示用户统计数据（已完成比赛/PB/年龄组/排名）
11. ✅ 显示历史比赛卡片
12. ✅ 点击搜索进入搜索页面
13. ✅ 搜索后进入 HUB 显示全部比赛卡片
14. ✅ 点击卡片进入 SUMMARY → SPLIT_CENTER 流程正常

### 10.4 PlanTab (比赛)
15. ✅ 分析报告页面正常显示
16. ✅ 订阅/教练列表流程正常

### 10.5 通用
17. ✅ 页面切换动画流畅
18. ✅ 返回按钮逻辑正确
19. ✅ 无控制台错误

---

## 十一、相关文档

- [API 文档: v3.0 Analytics API](../api/v3.0-analytics-api.md)
- [本地开发指南](../deployment/v2.0-local-dev-guide.md)
- [v3.1 PRD](./v3.1-data-tab-iteration.md)
