<!--æ¯”èµ›æ€»ç»“é¡µ-->
<view class="page-container">
  <!-- èƒŒæ™¯ç½‘æ ¼ -->
  <view class="bg-grid"></view>
  
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="back-btn" bindtap="onBack">
      <text class="back-icon">â†</text>
    </view>
    <text class="header-title">æ¯”èµ›æ€»ç»“</text>
    <button class="share-btn" open-type="share">
      <text class="share-icon">â†—</text>
    </button>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && error}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <view class="retry-btn" bindtap="loadData">é‡è¯•</view>
    <view class="back-link" bindtap="onBack">è¿”å›</view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view scroll-y class="content" wx:if="{{!loading && !error}}">
    <!-- ä¸»å¡ç‰‡ -->
    <view class="summary-card">
      <view class="card-header">
        <view class="race-info">
          <text class="race-name">{{race.event_name}}</text>
          <view class="athlete-name-row">
            <text class="athlete-name">{{athlete.name}}</text>
          </view>
        </view>
        <view class="trophy-icon">ğŸ†</view>
      </view>

      <!-- æ ¸å¿ƒæˆç»© -->
      <view class="main-result">
        <text class="time-label">OFFICIAL TIME</text>
        <text class="total-time">{{results.total_time}}</text>
      </view>

      <!-- å¾½ç« å’Œæ’å -->
      <view class="badges-row">
        <view class="badge-item gold" wx:if="{{badge}}">
          <text class="badge-icon">ğŸ…</text>
          <text class="badge-text">{{badge.text}}</text>
        </view>
        <view class="badge-item">
          <text class="badge-label">ç»„åˆ«æ’å</text>
          <text class="badge-value">#{{rankings.division_rank}}<text class="badge-sub">/{{rankings.division_total}}</text></text>
          <text class="badge-beat">å‡»è´¥ {{beatPercent}}%</text>
        </view>
        <view class="badge-item" wx:if="{{rankings.age_group_rank}}">
          <text class="badge-label">å¹´é¾„ç»„</text>
          <text class="badge-value">#{{rankings.age_group_rank}}<text class="badge-sub">/{{rankings.age_group_total}}</text></text>
          <text class="badge-beat">å‡»è´¥ {{ageGroupBeatPercent}}%</text>
        </view>
      </view>
    </view>

    <!-- æ—¶é—´åˆ†å¸ƒ - ä¸‰åˆ—å¸ƒå±€ -->
    <view class="breakdown-card">
      <view class="breakdown-col">
        <view class="breakdown-icon run">ğŸƒ</view>
        <text class="breakdown-title">è·‘æ­¥ (8åœˆ)</text>
        <text class="breakdown-sub">8åœˆæ€»ç”¨æ—¶</text>
        <text class="breakdown-time">{{results.run_time || '00:00:00'}}</text>
        <view class="breakdown-link" bindtap="onGoSplits" data-tab="run">
          <text>ç‚¹å‡»æŸ¥çœ‹</text>
          <text class="link-arrow">â€º</text>
        </view>
      </view>
      
      <view class="breakdown-divider-v"></view>
      
      <view class="breakdown-col">
        <view class="breakdown-icon workout">ğŸ’ª</view>
        <text class="breakdown-title">ç«™ç‚¹ (8ä¸ª)</text>
        <text class="breakdown-sub">8é¡¹åŠŸèƒ½ç«™æ€»ç”¨æ—¶</text>
        <text class="breakdown-time">{{results.work_time || '00:00:00'}}</text>
        <view class="breakdown-link" bindtap="onGoSplits" data-tab="station">
          <text>ç‚¹å‡»æŸ¥çœ‹</text>
          <text class="link-arrow">â€º</text>
        </view>
      </view>
      
      <view class="breakdown-divider-v"></view>
      
      <view class="breakdown-col">
        <view class="breakdown-icon roxzone">âš¡</view>
        <text class="breakdown-title">è½¬æ¢åŒº (8æ®µ)</text>
        <text class="breakdown-sub">8æ¬¡è½¬æ¢åŒºæ€»ç”¨æ—¶</text>
        <text class="breakdown-time">{{results.roxzone_time || '00:00:00'}}</text>
        <view class="breakdown-link" bindtap="onGoSplits" data-tab="overview">
          <text>ç‚¹å‡»æŸ¥çœ‹</text>
          <text class="link-arrow">â€º</text>
        </view>
      </view>
    </view>

    <!-- è®¤é¢†æ  -->
    <view class="claim-bar">
      <view class="claim-icon-wrap">
        <text class="claim-icon">{{isClaimed ? 'âœ…' : 'ğŸ‘¤'}}</text>
      </view>
      <view class="claim-info">
        <text class="claim-title">{{isClaimed ? 'å·²è®¤é¢†æˆç»©' : 'è¿™æ˜¯æ‚¨çš„æˆç»©ï¼Ÿ'}}</text>
        <text class="claim-desc">{{isClaimed ? 'è¯¥æˆç»©å·²ä¿å­˜åˆ°æ‚¨çš„æ¡£æ¡ˆ' : 'è®¤é¢†åå¯æ°¸ä¹…ä¿å­˜å¹¶åˆ†æ'}}</text>
      </view>
      <view 
        class="claim-btn {{isClaimed ? 'claimed' : ''}}" 
        bindtap="{{isClaimed ? 'onUnclaim' : 'onClaim'}}"
      >{{isClaimed ? 'å–æ¶ˆè®¤é¢†' : 'å»è®¤é¢†'}}</view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <view class="primary-btn" bindtap="onGoSplits">
        <text class="btn-icon">âœ¨</text>
        <view class="btn-content">
          <text class="btn-title">æŸ¥çœ‹å¿«é€Ÿåˆ†æ Lite</text>
          <text class="btn-desc">1åˆ†é’Ÿè¯»æ‡‚æ¯”èµ›è¡¨ç°</text>
        </view>
      </view>

      <view class="secondary-btn" bindtap="onGeneratePoster">
        <text class="sec-btn-icon">ğŸ–¼ï¸</text>
        <text class="sec-btn-text">ç”Ÿæˆæˆ˜æŠ¥æµ·æŠ¥</text>
      </view>
    </view>

    <!-- åº•éƒ¨æç¤º -->
    <view class="footer-tip">
      <text class="tip-icon">âŒš</text>
      <text class="tip-text">ä¸Šä¼ æ‰‹è¡¨æ•°æ®è§£é”ç²¾ç¡®é…é€Ÿåˆ†æ</text>
    </view>
  </scroll-view>
</view>
