<!--ä¸ªäººèµ„æ–™é¡µ-->
<view class="page-container">
  <view class="content">
    <!-- æœªç™»å½•çŠ¶æ€ -->
    <block wx:if="{{!isLoggedIn}}">
      <view class="login-section">
        <view class="login-icon">ğŸ‘¤</view>
        <text class="login-title">ç™»å½• HYROX Agent</text>
        <text class="login-desc">ç™»å½•åå¯ä¿å­˜æ¯”èµ›æ•°æ®ã€æŸ¥çœ‹å†å²è®°å½•</text>
        
        <button 
          class="login-btn {{isLoading ? 'loading' : ''}}"
          bindtap="onLogin"
          disabled="{{isLoading}}"
        >
          <text class="btn-icon" wx:if="{{!isLoading}}">ğŸ”</text>
          <view class="loading-spinner" wx:if="{{isLoading}}"></view>
          <text class="btn-text">{{isLoading ? 'ç™»å½•ä¸­...' : 'å¾®ä¿¡ä¸€é”®ç™»å½•'}}</text>
        </button>
        
        <text class="login-tip">ç™»å½•å³è¡¨ç¤ºåŒæ„æœåŠ¡æ¡æ¬¾å’Œéšç§æ”¿ç­–</text>
      </view>

      <!-- æœç´¢å…¥å£ -->
      <view class="guest-search" bindtap="onGoSearch">
        <text class="search-icon">ğŸ”</text>
        <text class="search-text">ä¸ç™»å½•ä¹Ÿå¯ä»¥æœç´¢è¿åŠ¨å‘˜</text>
        <text class="search-arrow">â†’</text>
      </view>
    </block>

    <!-- å·²ç™»å½•çŠ¶æ€ -->
    <block wx:else>
      <!-- å¤´åƒåŒºåŸŸ -->
      <view class="profile-header">
        <view class="avatar-wrapper" bindtap="onEditProfile">
          <image 
            class="avatar-img" 
            src="{{user.avatar_url}}" 
            mode="aspectFill"
            wx:if="{{user.avatar_url}}"
          />
          <view class="avatar-placeholder" wx:else>
            <text class="avatar-text">{{user.nickname ? user.nickname[0] : '?'}}</text>
          </view>
        </view>
        
        <view class="user-info" bindtap="onEditProfile">
          <text class="user-name">{{user.nickname || 'ç‚¹å‡»è®¾ç½®æ˜µç§°'}}</text>
          <view class="user-tags">
            <text class="tag id-tag">ID: {{user.id}}</text>
          </view>
        </view>
        
        <view class="settings-btn" bindtap="onSettings">
          <text class="settings-icon">âš™ï¸</text>
        </view>
      </view>

      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-grid">
        <view class="stat-card">
          <text class="stat-label">å·²è®¤é¢†æ¯”èµ›</text>
          <text class="stat-value">{{stats.completed}}</text>
        </view>
        <view class="stat-card highlight">
          <text class="stat-label primary">ä¸ªäººæœ€ä½³ (PB)</text>
          <text class="stat-value">{{stats.pb}}</text>
        </view>
      </view>

      <!-- Tab æ  -->
      <view class="tabs">
        <view 
          class="tab {{activeTab === 'races' ? 'active' : ''}}"
          data-tab="races"
          bindtap="onTabChange"
        >æˆ‘çš„æ¯”èµ›</view>
        <view 
          class="tab {{activeTab === 'training' ? 'active' : ''}}"
          data-tab="training"
          bindtap="onTabChange"
        >è®­ç»ƒæ•°æ®</view>
      </view>

      <!-- æ¯”èµ› Tab å†…å®¹ -->
      <block wx:if="{{activeTab === 'races'}}">
        <!-- æœç´¢å…¥å£ -->
        <view class="search-entry" bindtap="onGoSearch">
          <text class="search-icon">ğŸ”</text>
          <text class="search-text">æœç´¢å¹¶è®¤é¢†æ›´å¤šæ¯”èµ›...</text>
          <text class="search-arrow">â†’</text>
        </view>

        <!-- åŠ è½½ä¸­ -->
        <view class="loading-state" wx:if="{{claimedLoading}}">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>

        <!-- å·²è®¤é¢†æ¯”èµ›åˆ—è¡¨ -->
        <view class="claimed-list" wx:if="{{!claimedLoading && claimedRaces.length > 0}}">
          <view 
            class="claimed-card"
            wx:for="{{claimedRaces}}"
            wx:key="id"
            data-item="{{item}}"
            bindtap="onTapClaimedRace"
          >
            <view class="card-left">
              <view class="season-badge">S{{item.season}}</view>
            </view>
            <view class="card-center">
              <text class="event-name">{{item.event_name}}</text>
              <text class="athlete-name">{{item.athlete_name}}</text>
            </view>
            <view class="card-right">
              <text class="total-time">{{item.total_time}}</text>
              <view 
                class="unclaim-btn" 
                catchtap="onUnclaimFromList" 
                data-item="{{item}}"
              >å–æ¶ˆ</view>
            </view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{!claimedLoading && claimedRaces.length === 0}}">
          <view class="empty-icon">ğŸƒ</view>
          <text class="empty-title">æš‚æ— è®¤é¢†çš„æ¯”èµ›</text>
          <text class="empty-desc">æœç´¢è¿åŠ¨å‘˜å¹¶è®¤é¢†æ‚¨çš„æ¯”èµ›æˆç»©</text>
          <view class="empty-btn" bindtap="onGoSearch">
            <text>å»æœç´¢</text>
          </view>
        </view>
      </block>

      <!-- è®­ç»ƒæ•°æ® Tab å†…å®¹ -->
      <block wx:if="{{activeTab === 'training'}}">
        <view class="empty-state">
          <view class="empty-icon">ğŸ“Š</view>
          <text class="empty-title">è®­ç»ƒæ•°æ®åŠŸèƒ½å¼€å‘ä¸­</text>
          <text class="empty-desc">æ•¬è¯·æœŸå¾…</text>
        </view>
      </block>
    </block>
  </view>
</view>
