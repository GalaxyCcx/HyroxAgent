<!--æ’è¡Œæ¦œé¡µé¢-->
<view class="page-container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-top">
      <view class="back-btn" bindtap="onBack">
        <text class="back-icon">â€¹</text>
      </view>
      <text class="header-title">{{raceName || 'æˆç»©åˆ—è¡¨'}}</text>
      <view class="search-toggle" bindtap="toggleSearch">
        <text class="search-icon">ğŸ”</text>
      </view>
    </view>
    
    <!-- ç­›é€‰åŒºåŸŸ -->
    <view class="filters">
      <!-- ä¸€çº§ï¼šå•äººèµ›/åŒäººèµ› -->
      <view class="filter-tabs">
        <view 
          class="tab {{raceType === 'single' ? 'active' : ''}}"
          data-type="single"
          bindtap="onRaceTypeChange"
        >å•äººèµ›</view>
        <view 
          class="tab {{raceType === 'doubles' ? 'active' : ''}}"
          data-type="doubles"
          bindtap="onRaceTypeChange"
        >åŒäººèµ›</view>
      </view>
      
      <!-- äºŒçº§ï¼šç»„åˆ« -->
      <view class="filter-buttons">
        <view 
          class="filter-btn {{division === 'open' ? 'active' : ''}}"
          data-division="open"
          bindtap="onDivisionChange"
        >{{raceType === 'doubles' ? 'Doubles' : 'Open'}}</view>
        <view 
          class="filter-btn {{division === 'pro' ? 'active' : ''}}"
          data-division="pro"
          bindtap="onDivisionChange"
        >{{raceType === 'doubles' ? 'Pro Doubles' : 'Pro'}}</view>
      </view>
      
      <!-- ä¸‰çº§ï¼šæ€§åˆ« + å¹´é¾„ç»„ -->
      <view class="filter-chips">
        <view class="gender-chips">
          <view 
            class="chip {{gender === 'male' ? 'active' : ''}}"
            data-gender="male"
            bindtap="onGenderChange"
          >ç”·å­</view>
          <view 
            class="chip {{gender === 'female' ? 'active' : ''}}"
            data-gender="female"
            bindtap="onGenderChange"
          >å¥³å­</view>
          <view 
            class="chip {{gender === 'mixed' ? 'active' : ''}}"
            data-gender="mixed"
            bindtap="onGenderChange"
            wx:if="{{raceType === 'doubles'}}"
          >æ··åŒ</view>
        </view>
        
        <!-- å¹´é¾„ç»„ä¸‹æ‹‰ -->
        <view class="age-dropdown" bindtap="toggleAgeDropdown">
          <text class="age-label">å¹´é¾„ç»„: {{ageGroup === 'ALL' ? 'å…¨éƒ¨' : ageGroup}}</text>
          <text class="dropdown-arrow">{{showAgeDropdown ? 'â–²' : 'â–¼'}}</text>
        </view>
      </view>
      
      <!-- å¹´é¾„ç»„é€‰é¡¹ -->
      <view class="age-options" wx:if="{{showAgeDropdown}}">
        <view 
          class="age-option {{ageGroup === 'ALL' ? 'active' : ''}}"
          data-age="ALL"
          bindtap="onAgeSelect"
        >å…¨éƒ¨ (All)</view>
        <view 
          class="age-option {{ageGroup === item ? 'active' : ''}}"
          wx:for="{{ageOptions}}"
          wx:key="*this"
          data-age="{{item}}"
          bindtap="onAgeSelect"
        >{{item}}</view>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½æ’è¡Œæ¦œ...</text>
    </view>
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <view class="error-tip" wx:if="{{!loading && error}}">
      <text class="error-text">{{error}}</text>
      <view class="retry-btn" bindtap="loadLeaderboard">é‡è¯•</view>
    </view>
    
    <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
    <view class="leaderboard" wx:if="{{!loading && !error}}">
      <text class="total-count">å…± {{total}} ä½é€‰æ‰‹</text>
      
      <view 
        class="entry-card {{item.rank === 1 ? 'first' : ''}}"
        wx:for="{{leaderboard}}"
        wx:key="rank"
        data-entry="{{item}}"
        bindtap="onTapEntry"
      >
        <!-- æ’å -->
        <view class="rank {{item.rank <= 3 ? 'top3' : ''}}">{{item.rank}}</view>
        
        <!-- é€‰æ‰‹ä¿¡æ¯ -->
        <view class="entry-info">
          <view class="entry-name">
            <text>{{item.name}}</text>
            <text class="gender-icon" wx:if="{{item.gender === 'female'}}">â™€</text>
          </view>
          <view class="entry-meta">
            <text class="division-tag">{{division === 'pro' ? 'PRO' : 'OPEN'}}</text>
            <text class="age-tag" wx:if="{{item.age_group}}">{{item.age_group}}</text>
          </view>
        </view>
        
        <!-- æˆç»© -->
        <view class="entry-result">
          <text class="total-time">{{item.total_time}}</text>
          <view class="view-btn">æŸ¥çœ‹</view>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty" wx:if="{{leaderboard.length === 0}}">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— æ’è¡Œæ¦œæ•°æ®</text>
      </view>
    </view>
  </view>
</view>
