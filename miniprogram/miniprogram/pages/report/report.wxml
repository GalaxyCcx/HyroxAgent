<!--
  ä¸“ä¸šåˆ†ææŠ¥å‘Šè¯¦æƒ…é¡µ
  æ”¯æŒ5ä¸ªç« èŠ‚å±•ç¤ºï¼šæ€»è§ˆã€è·‘æ­¥åˆ†æã€è®­ç»ƒç«™åˆ†æã€å¿ƒç‡åˆ†æã€å»ºè®®
-->
<view class="report-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½æŠ¥å‘Šä¸­...</text>
  </view>

  <!-- ç”Ÿæˆä¸­çŠ¶æ€ -->
  <view wx:elif="{{generating}}" class="generating-container">
    <view class="generating-card">
      <view class="generating-icon">
        <view class="pulse-ring"></view>
        <text class="icon-text">AI</text>
      </view>
      <text class="generating-title">æ­£åœ¨ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š</text>
      <progress-bar
        percent="{{generateProgress}}"
        step-text="{{generateStep}}"
        animated="{{true}}"
      />
      <text class="generating-hint">AI æ­£åœ¨åˆ†ææ‚¨çš„æ¯”èµ›æ•°æ®ï¼Œè¯·ç¨å€™...</text>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view wx:elif="{{error}}" class="error-container">
    <view class="error-icon">!</view>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bind:tap="onRetry">é‡è¯•</button>
  </view>

  <!-- æŠ¥å‘Šå†…å®¹ -->
  <scroll-view 
    wx:else 
    scroll-y 
    class="report-content"
    enhanced="{{true}}"
    show-scrollbar="{{false}}"
  >
    <!-- æŠ¥å‘Šå¤´éƒ¨ -->
    <view class="report-header">
      <view class="header-badge">ä¸“ä¸šåˆ†æ</view>
      <text class="report-title">{{report.title || 'æ¯”èµ›åˆ†ææŠ¥å‘Š'}}</text>
      <view class="report-meta">
        <text class="meta-item">{{report.athlete_name}}</text>
        <text class="meta-divider">|</text>
        <text class="meta-item">{{report.race_info}}</text>
      </view>
      <view class="report-time">
        <text>ç”Ÿæˆæ—¶é—´ï¼š{{report.created_at}}</text>
      </view>
    </view>

    <!-- ç« èŠ‚å¯¼èˆª -->
    <scroll-view scroll-x class="section-nav">
      <view 
        wx:for="{{sections}}" 
        wx:key="id"
        class="nav-item {{activeSection === item.id ? 'active' : ''}}"
        bind:tap="onSectionTap"
        data-id="{{item.id}}"
      >
        <text class="nav-icon">{{item.icon}}</text>
        <text class="nav-text">{{item.title}}</text>
      </view>
    </scroll-view>

    <!-- ç« èŠ‚å†…å®¹ -->
    <view class="sections-container">
      <view 
        wx:for="{{report.sections}}" 
        wx:key="id"
        id="section-{{item.id}}"
        class="section"
      >
        <!-- ç« èŠ‚æ ‡é¢˜ -->
        <view class="section-header">
          <view class="section-number">{{index + 1}}</view>
          <text class="section-title">{{item.title}}</text>
        </view>

        <!-- ç« èŠ‚å†…å®¹å— -->
        <view class="section-content">
          <block-renderer 
            wx:for="{{item.blocks}}" 
            wx:key="blockIndex"
            wx:for-item="block"
            wx:for-index="blockIndex"
            block="{{block}}"
          />
        </view>
      </view>
    </view>

    <!-- æŠ¥å‘Šåº•éƒ¨ -->
    <view class="report-footer">
      <text class="footer-text">â€” æŠ¥å‘Šç»“æŸ â€”</text>
      <view class="footer-actions">
        <button class="action-btn share-btn" open-type="share">
          <text class="btn-icon">â†—</text>
          <text>åˆ†äº«æŠ¥å‘Š</text>
        </button>
        <button class="action-btn poster-btn" bind:tap="onGeneratePoster">
          <text class="btn-icon">ğŸ“·</text>
          <text>ç”Ÿæˆæµ·æŠ¥</text>
        </button>
      </view>
    </view>
  </scroll-view>
</view>
