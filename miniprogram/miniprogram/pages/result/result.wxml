<!--pages/result/result.wxml-->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
  
  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && error}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <view class="retry-btn" bindtap="onRetry">é‡è¯•</view>
    <view class="back-btn" bindtap="onBack">è¿”å›</view>
  </view>
  
  <!-- å†…å®¹åŒºåŸŸ -->
  <block wx:if="{{!loading && !error}}">
    <!-- æ¯”èµ›åˆ—è¡¨æ¨¡å¼ -->
    <block wx:if="{{mode === 'list'}}">
      <view class="list-header">
        <view class="athlete-name-header">{{athleteName}}</view>
        <view class="list-count">å…± {{raceList.length}} åœºæ¯”èµ›</view>
      </view>
      
      <view class="race-list" wx:if="{{raceList.length > 0}}">
        <view 
          class="race-card"
          wx:for="{{raceList}}"
          wx:key="id"
          data-item="{{item}}"
          bindtap="onTapRace"
        >
          <view class="race-card-header">
            <view class="race-event">{{item.event_name}}</view>
            <view class="race-time">{{item.total_time}}</view>
          </view>
          <view class="race-card-body">
            <text class="race-tag">Season {{item.season}}</text>
            <text class="race-tag">{{item.location}}</text>
            <text class="race-tag">{{item.division}}</text>
          </view>
          <view class="race-card-arrow">â€º</view>
        </view>
      </view>
      
      <view class="empty" wx:if="{{raceList.length === 0}}">
        <view class="empty-icon">ğŸƒ</view>
        <text class="empty-text">æš‚æ— æ¯”èµ›è®°å½•</text>
      </view>
    </block>
    
    <!-- è¯¦æƒ…æ¨¡å¼ -->
    <block wx:if="{{mode === 'detail'}}">
    <!-- å¤´éƒ¨ï¼šæ¯”èµ›ä¿¡æ¯ -->
    <view class="header-section">
      <view class="race-name">{{race.event_name}}</view>
      <view class="race-info">
        <text class="division-tag">{{athlete.gender === 'male' ? "Men's" : "Women's"}} {{athlete.division}}</text>
        <text class="age-tag" wx:if="{{athlete.age_group}}">Age {{athlete.age_group}}</text>
      </view>
    </view>
    
    <!-- è¿åŠ¨å‘˜ä¿¡æ¯ -->
    <view class="athlete-section">
      <view class="athlete-avatar">
        <text class="avatar-emoji">ğŸ‘¤</text>
      </view>
      <view class="athlete-info">
        <view class="athlete-name">{{athlete.name}}</view>
        <view class="athlete-meta">
          <text wx:if="{{athlete.nationality_name}}">{{athlete.nationality_name}}</text>
          <text wx:if="{{race.date}}"> â€¢ {{race.date}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ ¸å¿ƒæˆç»© -->
    <view class="result-section card">
      <view class="result-main">
        <view class="total-time">{{results.total_time}}</view>
        <view class="overall-rank">#{{rankings.overall_rank}} / {{rankings.overall_total}}</view>
      </view>
      <view class="result-ranks">
        <view class="rank-item">
          <text class="rank-label">æ€§åˆ«æ’å</text>
          <text class="rank-value">#{{rankings.gender_rank}} / {{rankings.gender_total}}</text>
        </view>
        <view class="rank-item">
          <text class="rank-label">ç»„åˆ«æ’å</text>
          <text class="rank-value">#{{rankings.division_rank}} / {{rankings.division_total}}</text>
        </view>
        <view class="rank-item" wx:if="{{rankings.age_group_rank}}">
          <text class="rank-label">å¹´é¾„ç»„æ’å</text>
          <text class="rank-value">#{{rankings.age_group_rank}} / {{rankings.age_group_total}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ—¶é—´åˆ†å¸ƒ -->
    <view class="time-dist-section card">
      <view class="section-title">æ—¶é—´åˆ†å¸ƒ</view>
      
      <!-- Running -->
      <view class="time-bar-item">
        <view class="bar-header">
          <text class="bar-label">Running</text>
          <text class="bar-time">{{results.run_time}}</text>
          <text class="bar-percent">{{results.run_time_percent}}%</text>
        </view>
        <view class="bar-track">
          <view class="bar-fill bar-running" style="width: {{results.run_time_percent}}%"></view>
        </view>
      </view>
      
      <!-- Workout -->
      <view class="time-bar-item">
        <view class="bar-header">
          <text class="bar-label">Workout</text>
          <text class="bar-time">{{results.work_time}}</text>
          <text class="bar-percent">{{results.work_time_percent}}%</text>
        </view>
        <view class="bar-track">
          <view class="bar-fill bar-workout" style="width: {{results.work_time_percent}}%"></view>
        </view>
      </view>
      
      <!-- Roxzone -->
      <view class="time-bar-item">
        <view class="bar-header">
          <text class="bar-label">Roxzone</text>
          <text class="bar-time">{{results.roxzone_time}}</text>
          <text class="bar-percent">{{results.roxzone_time_percent}}%</text>
        </view>
        <view class="bar-track">
          <view class="bar-fill bar-roxzone" style="width: {{results.roxzone_time_percent}}%"></view>
        </view>
      </view>
    </view>
    
    <!-- åˆ†æ®µæˆç»© -->
    <view class="splits-section card">
      <view class="section-title">åˆ†æ®µæˆç»©</view>
      
      <view class="splits-list">
        <!-- äº¤æ›¿æ˜¾ç¤º Run å’Œ Workout -->
        <block wx:for="{{8}}" wx:key="idx" wx:for-item="idx">
          <!-- Run -->
          <view class="split-item run-item">
            <view class="split-icon">ğŸƒ</view>
            <view class="split-info">
              <text class="split-name">{{splits.runs[idx].name}}</text>
              <text class="split-dist">{{splits.runs[idx].distance}}</text>
            </view>
            <text class="split-time">{{splits.runs[idx].time}}</text>
          </view>
          
          <!-- Workout -->
          <view class="split-item workout-item">
            <view class="split-icon">ğŸ’ª</view>
            <view class="split-info">
              <text class="split-name">{{splits.workouts[idx].name}}</text>
              <text class="split-dist">{{splits.workouts[idx].distance}}</text>
            </view>
            <text class="split-time">{{splits.workouts[idx].time}}</text>
          </view>
        </block>
      </view>
    </view>
    </block>
  </block>
</view>




