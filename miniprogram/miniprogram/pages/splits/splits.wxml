<!--åˆ†æ®µä¸­å¿ƒé¡µ-->
<view class="page-container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-top">
      <view class="back-btn" bindtap="onBack">
        <text class="back-icon">â€¹</text>
      </view>
      <view class="header-title">
        <text class="title-main">åˆ†æ®µè¯¦æƒ…</text>
        <text class="title-sub">{{raceName}}</text>
      </view>
      <view class="more-btn">
        <text class="more-icon">â‹®</text>
      </view>
    </view>
    
    <!-- æ€»è§ˆå¡ç‰‡ -->
    <view class="stats-card" wx:if="{{!loading && !error}}">
      <view class="stat-item">
        <text class="stat-label">æ€»æ’å</text>
        <text class="stat-value">#{{rankings.overall_rank}} <text class="stat-sub">/ {{rankings.overall_total}}</text></text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-label">è¡¨ç°è¯„çº§</text>
        <text class="stat-value primary">{{badge.text || '-'}}</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-label">æ€»ç”¨æ—¶</text>
        <text class="stat-value">{{results.total_time}}</text>
      </view>
    </view>
    
    <!-- Tab æ  -->
    <view class="tabs" wx:if="{{!loading && !error}}">
      <view 
        class="tab {{activeTab === 'overview' ? 'active' : ''}}"
        data-tab="overview"
        bindtap="onTabChange"
      >æ€»è§ˆ</view>
      <view 
        class="tab {{activeTab === 'run' ? 'active' : ''}}"
        data-tab="run"
        bindtap="onTabChange"
      >è·‘æ­¥ ({{runAnalytics.length}})</view>
      <view 
        class="tab {{activeTab === 'station' ? 'active' : ''}}"
        data-tab="station"
        bindtap="onTabChange"
      >ç«™ç‚¹ ({{stationAnalytics.length}})</view>
      <view 
        class="tab {{activeTab === 'roxzone' ? 'active' : ''}}"
        data-tab="roxzone"
        bindtap="onTabChange"
      >è½¬æ¢åŒº</view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½åˆ†æ®µæ•°æ®...</text>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error-state" wx:if="{{!loading && error}}">
    <text class="error-text">{{error}}</text>
    <view class="retry-btn" bindtap="loadData">é‡è¯•</view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content" wx:if="{{!loading && !error}}">
    <!-- æ€»è§ˆ Tab -->
    <view class="splits-list" wx:if="{{activeTab === 'overview'}}">
      <view class="list-header">
        <text class="col col-item">é¡¹ç›®</text>
        <text class="col col-time">ç”¨æ—¶</text>
        <text class="col col-top">æ’å%</text>
        <text class="col col-diff">å‡å€¼å·®</text>
        <text class="col col-bar">è¿›åº¦</text>
      </view>
      
      <block wx:for="{{splitsAnalytics}}" wx:key="index">
        <view class="split-row {{item.top_percent > 45 ? 'warning' : ''}}">
          <view class="col col-item">
            <text class="item-label {{item.type === 'run' ? 'run' : ''}}">{{item.label}}</text>
            <text class="item-name">{{item.displayName}}</text>
          </view>
          <text class="col col-time {{item.top_percent > 45 ? 'warning' : ''}}">{{item.time}}</text>
          <text class="col col-top {{item.top_percent < 20 ? 'good' : item.top_percent > 45 ? 'warning' : ''}}">{{item.top_percent}}%</text>
          <text class="col col-diff {{item.diff_seconds < 0 ? 'good' : ''}}">{{item.diff_display}}</text>
          <view class="col col-bar">
            <view class="bar-track">
              <view class="bar-fill {{item.top_percent > 45 ? 'warning' : ''}}" style="width: {{100 - item.top_percent}}%"></view>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- Run Tab -->
    <view class="splits-list" wx:if="{{activeTab === 'run'}}">
      <view class="list-header">
        <text class="col col-item">é¡¹ç›®</text>
        <text class="col col-time">ç”¨æ—¶</text>
        <text class="col col-top">æ’å%</text>
        <text class="col col-diff">å‡å€¼å·®</text>
        <text class="col col-bar">è¿›åº¦</text>
      </view>
      <block wx:for="{{runAnalytics}}" wx:key="index">
        <view class="split-row {{item.top_percent > 50 ? 'warning' : ''}}">
          <view class="col col-item">
            <text class="item-label run">{{item.label}}</text>
            <text class="item-name">{{item.displayName}}</text>
          </view>
          <text class="col col-time {{item.top_percent > 50 ? 'warning' : ''}}">{{item.time}}</text>
          <text class="col col-top {{item.top_percent < 20 ? 'good' : item.top_percent > 50 ? 'warning' : ''}}">{{item.top_percent}}%</text>
          <text class="col col-diff {{item.diff_seconds < 0 ? 'good' : ''}}">{{item.diff_display}}</text>
          <view class="col col-bar">
            <view class="bar-track">
              <view class="bar-fill {{item.top_percent > 50 ? 'warning' : item.top_percent > 30 ? 'neutral' : 'good'}}" style="width: {{100 - item.top_percent}}%"></view>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- Station Tab -->
    <view class="splits-list cards" wx:if="{{activeTab === 'station'}}">
      <block wx:for="{{stationAnalytics}}" wx:key="index">
        <view class="station-card {{item.top_percent > 60 ? 'risk' : item.top_percent > 40 ? 'warning' : ''}}">
          <view class="station-header">
            <view class="station-info">
              <text class="station-name">{{item.displayName}}</text>
              <text class="warning-icon" wx:if="{{item.top_percent > 60}}">âš ï¸</text>
            </view>
            <view class="station-result">
              <text class="station-time">{{item.time}}</text>
              <text class="station-top {{item.top_percent > 40 ? 'warning' : 'good'}}">å‰ {{item.top_percent}}%</text>
            </view>
          </view>
          <view class="station-bar">
            <view class="bar-track">
              <view class="bar-fill {{item.top_percent > 40 ? 'warning' : 'good'}}" style="width: {{100 - item.top_percent}}%"></view>
            </view>
          </view>
          <text class="station-diff {{item.diff_seconds < 0 ? 'good' : 'warning'}}">{{item.diff_display}}</text>
        </view>
      </block>
    </view>

    <!-- Roxzone Tab -->
    <view class="roxzone-content" wx:if="{{activeTab === 'roxzone'}}">
      <!-- æ€»è½¬æ¢åŒºæ—¶é—´å¡ç‰‡ -->
      <view class="roxzone-hero-card">
        <view class="roxzone-icon">âš¡</view>
        <view class="roxzone-info">
          <text class="roxzone-label">8æ¬¡è½¬æ¢åŒºæ€»ç”¨æ—¶</text>
          <text class="roxzone-time">{{results.roxzone_time || '--:--:--'}}</text>
        </view>
      </view>
      
      <!-- è¯´æ˜å¡ç‰‡ -->
      <view class="roxzone-note-card">
        <view class="note-icon">ğŸ’¡</view>
        <view class="note-content">
          <text class="note-title">å…³äºè½¬æ¢åŒº</text>
          <text class="note-desc">è½¬æ¢åŒº (Roxzone) æ˜¯è·‘æ­¥ä¸åŠŸèƒ½ç«™ä¹‹é—´çš„è¿‡æ¸¡åŒºåŸŸã€‚ç›®å‰ä»…æä¾›æ€»æ—¶é—´æ•°æ®ï¼Œæš‚æ— å„æ®µè¯¦ç»†åˆ†æ®µã€‚</text>
        </view>
      </view>
      
      <!-- å»ºè®®å¡ç‰‡ -->
      <view class="roxzone-tip-card">
        <text class="tip-title">ä¼˜åŒ–å»ºè®®</text>
        <view class="tip-item">
          <text class="tip-bullet">â€¢</text>
          <text class="tip-text">è¿›å…¥åŠŸèƒ½ç«™å‰æå‰è§„åˆ’åŠ¨ä½œï¼Œå‡å°‘çŠ¹è±«æ—¶é—´</text>
        </view>
        <view class="tip-item">
          <text class="tip-bullet">â€¢</text>
          <text class="tip-text">ä¿æŒç¨³å®šé…é€Ÿï¼Œé¿å…åœ¨è½¬æ¢åŒºè¿‡åº¦å–˜æ¯</text>
        </view>
        <view class="tip-item">
          <text class="tip-bullet">â€¢</text>
          <text class="tip-text">ç†Ÿæ‚‰åœºåœ°å¸ƒå±€ï¼Œæå‰é¢„åˆ¤ä¸‹ä¸€ç«™ä½ç½®</text>
        </view>
      </view>
    </view>
  </view>
</view>
